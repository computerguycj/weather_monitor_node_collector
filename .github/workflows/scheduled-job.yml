name: Daily Node Collector Job

on:
  schedule:
    - cron: '1 7 * * *'  # Daily at 7:01 UTC
  workflow_dispatch:     # Optional: manual trigger

jobs:
  run-node-collector:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Build container locally
        run: docker build -t node-collector .

      - name: Run container
        run: docker run --rm -e DATABASE_URL="${{ secrets.DATABASE_URL }}" node-collector

      - name: Debug Puppeteer inside container
        run: |
          docker run --rm node-collector node -e "console.log(require.resolve('puppeteer-core'))"
          docker run --rm node-collector node -e "console.log(require('puppeteer-core').executablePath())"
          docker run --rm node-collector ls -l /usr/bin/chromium || echo "Chromium not found"
